#!/bin/bash
# Crude script to generate a speakup kernel patch
# Usage: ./makepatch <KERNEL_VER>

if [[ $# -lt 1 ]]; then
	echo 'Usage: ./makepatch KERNEL_VER'
	exit
fi

SPK_DIR=$(pwd)
KV=$1
TMP=/tmp
K_PLAIN=linux-${KV}
K_SPK=linux-${KV}-spk
PATCH=speakup-${KV}.patch

SPKVER=$(./version)

cd ${TMP}
mkdir -p ${K_PLAIN}
mkdir -p ${K_SPK}

pushd ${K_PLAIN}
ketchup ${KV}
popd

pushd ${K_SPK}
ketchup ${KV}
popd

pushd ${SPK_DIR}
./install ${TMP}/${K_SPK}
popd

echo "speakup ${SPKVER} for Linux ${KV}" > ${SPK_DIR}/${PATCH}
echo "Generated by $(whoami) on $(date)" >> ${SPK_DIR}/${PATCH}
diff --exclude=*.orig --exclude=*.patch -urNp ${K_PLAIN} ${K_SPK} >> ${SPK_DIR}/${PATCH}
rm -rf ${K_SPK} ${K_PLAIN}

diffstat ${SPK_DIR}/${PATCH}
echo "Written to ${PATCH}"

